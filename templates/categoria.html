{% extends "base.html" %}

{% block title %}{{ categoria }} â€” ILearn{% endblock %}

{% block hero %}
<section class="category-hero category-{{ categoria_slug }}" id="category-page" data-category="{{ categoria_slug }}">
    <div id="cat-particles"></div>
    <div class="hero-content text-center" data-aos="fade-up" data-aos-duration="1000">
        <div class="category-icon mx-auto">
            {% if categoria_slug == 'cucina' %}
            <i class="bi bi-fire"></i>
            {% elif categoria_slug == 'scienza' %}
            <i class="bi bi-rocket-takeoff-fill"></i>
            {% elif categoria_slug == 'sport' %}
            <i class="bi bi-trophy-fill"></i>
            {% elif categoria_slug == 'tecnologia' %}
            <i class="bi bi-motherboard-fill"></i>
            {% elif categoria_slug == 'altro' %}
            <i class="bi bi-stars"></i>
            {% endif %}
        </div>
        <h1 class="hero-title">
            <span class="text-gradient">{{ categoria }}</span>
        </h1>
        <p class="hero-subtitle mx-auto">
            {% if categoria_slug == 'cucina' %}
            Ricette, tradizioni culinarie e segreti degli chef. Scopri il gusto dell'Italia e del mondo.
            {% elif categoria_slug == 'scienza' %}
            Dalle stelle ai laboratori: esplora le frontiere della conoscenza umana.
            {% elif categoria_slug == 'sport' %}
            Adrenalina, competizione e storie di atleti straordinari. Vivi lo sport a 360 gradi.
            {% elif categoria_slug == 'tecnologia' %}
            Innovazione, digitale e futuro. Resta al passo con il mondo tech che evolve ogni giorno.
            {% elif categoria_slug == 'altro' %}
            Filosofia, viaggi, cultura e tutto cio' che non rientra nelle categorie classiche.
            {% endif %}
        </p>
        <div class="category-stats mx-auto" data-aos="fade-up" data-aos-delay="200">
            <div class="category-stat">
                <div class="category-stat-number">{{ podcasts|length }}</div>
                <div class="category-stat-label">Podcast</div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block content %}
<!-- Category Pill Navigation -->
<div class="pill-filter-container category-{{ categoria_slug }}" data-aos="fade-up">
    <a href="{{ url_for('home') }}" class="pill-filter cat-pill">
        <i class="bi bi-grid-3x3-gap"></i> Tutte
    </a>
    {% for cat in categorie %}
    <a href="{{ url_for('categoria', nome_categoria=cat.lower()) }}"
       class="pill-filter cat-pill cat-pill-{{ cat.lower() }} {% if cat.lower() == categoria_slug %}active{% endif %}">
        {% if cat.lower() == 'cucina' %}<i class="bi bi-fire"></i>
        {% elif cat.lower() == 'scienza' %}<i class="bi bi-rocket-takeoff-fill"></i>
        {% elif cat.lower() == 'sport' %}<i class="bi bi-trophy-fill"></i>
        {% elif cat.lower() == 'tecnologia' %}<i class="bi bi-motherboard-fill"></i>
        {% elif cat.lower() == 'altro' %}<i class="bi bi-stars"></i>
        {% endif %} {{ cat }}
    </a>
    {% endfor %}
</div>

{% if podcasts %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 pb-4 card-grid category-{{ categoria_slug }} justify-content-center">
    {% for podcast in podcasts %}
    <div class="col" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 150 }}">
        <article class="glass-card">
            <div class="card-img-wrapper">
                <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">
                    <img class="card-img-top"
                         src="{{ url_for('static', filename='podcast' + podcast.podcast_id|string + podcast.Estensione) }}"
                         alt="Immagine del podcast {{ podcast.Titolo }}">
                </a>
            </div>
            <div class="card-body">
                <span class="badge-category mb-2">{{ podcast.Categoria }}</span>
                <h5 class="card-title">
                    <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">{{ podcast.Titolo }}</a>
                </h5>
                <p class="card-author"><i class="bi bi-person"></i> {{ podcast.Username }}</p>
                {% if ratings.get(podcast.podcast_id) and ratings[podcast.podcast_id].media > 0 %}
                <div class="star-rating-mini mt-1">
                    {% for i in range(1, 6) %}
                    <i class="bi bi-star{% if i <= ratings[podcast.podcast_id].media|round|int %}-fill{% elif i - 0.5 <= ratings[podcast.podcast_id].media %}-half{% endif %} star-gold"></i>
                    {% endfor %}
                    <small style="color: var(--text-muted);">{{ ratings[podcast.podcast_id].media }}</small>
                </div>
                {% endif %}
                <p class="card-text">{{ podcast.Descrizione[:120] }}{% if podcast.Descrizione|length > 120 %}...{% endif %}</p>
            </div>
        </article>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<nav class="d-flex justify-content-center pb-5">
    <ul class="pagination pagination-dark">
        {% if page > 1 %}
        <li class="page-item"><a class="page-link" href="{{ url_for('categoria', nome_categoria=categoria_slug, page=page-1) }}">&laquo;</a></li>
        {% endif %}
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item{% if p == page %} active{% endif %}">
            <a class="page-link" href="{{ url_for('categoria', nome_categoria=categoria_slug, page=p) }}">{{ p }}</a>
        </li>
        {% endfor %}
        {% if page < total_pages %}
        <li class="page-item"><a class="page-link" href="{{ url_for('categoria', nome_categoria=categoria_slug, page=page+1) }}">&raquo;</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="text-center py-5" data-aos="fade-up">
    <i class="bi bi-broadcast" style="font-size: 3rem; color: var(--text-muted);"></i>
    <h4 class="mt-3" style="color: var(--text-secondary);">Nessun podcast in questa categoria.</h4>
    <a href="{{ url_for('home') }}" class="btn btn-gradient mt-3"><i class="bi bi-house-door"></i> Torna alla Home</a>
</div>
{% endif %}

<div class="pb-5"></div>
{% endblock %}
