{% extends "base.html" %}

{% block js %}<script defer src="{{ url_for('static', filename='home.js') }}"></script>{% endblock %}

{% block title %}ILearn &mdash; Home{% endblock %}

{% block hero %}
<section class="hero-section">
    <div id="particles-js"></div>
    <div class="hero-content">
        <h1 class="hero-title"><span class="text-gradient">Scopri, Ascolta, Impara</span></h1>
        <p class="hero-subtitle">Esplora i migliori podcast educativi. Dalla scienza alla cucina, trova il contenuto perfetto per te.</p>
    </div>
</section>
{% endblock %}

{% block content %}
<!-- Trending Section -->
{% if trending %}
<h5 class="section-heading mt-4" data-aos="fade-up"><i class="bi bi-fire"></i> In tendenza</h5>
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
    {% for podcast in trending %}
    <div class="col" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
        <article class="glass-card" style="position: relative;">
            <div class="trending-badge">#{{ loop.index }}</div>
            <div class="card-img-wrapper">
                <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">
                    <img class="card-img-top"
                         src="{{ url_for('static', filename='podcast' + podcast.podcast_id|string + podcast.Estensione) }}"
                         alt="{{ podcast.Titolo }}">
                </a>
            </div>
            <div class="card-body">
                <span class="badge-category mb-2">{{ podcast.Categoria }}</span>
                <h5 class="card-title">
                    <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">{{ podcast.Titolo }}</a>
                </h5>
                <p class="card-author"><i class="bi bi-person"></i> {{ podcast.Username }}</p>
                <div class="card-followers">
                    <i class="bi bi-people-fill"></i> {{ podcast.follower_count }} follower
                </div>
                {% if ratings.get(podcast.podcast_id) and ratings[podcast.podcast_id].media > 0 %}
                <div class="star-rating-mini mt-1">
                    {% for i in range(1, 6) %}
                    <i class="bi bi-star{% if i <= ratings[podcast.podcast_id].media|round|int %}-fill{% elif i - 0.5 <= ratings[podcast.podcast_id].media %}-half{% endif %} star-gold"></i>
                    {% endfor %}
                    <small style="color: var(--text-muted);">{{ ratings[podcast.podcast_id].media }}</small>
                </div>
                {% endif %}
            </div>
        </article>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Top Rated Section -->
{% if top_rated %}
<h5 class="section-heading" data-aos="fade-up"><i class="bi bi-trophy-fill" style="color: #f59e0b;"></i> I pi√π apprezzati</h5>
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 mb-5">
    {% for podcast in top_rated %}
    <div class="col" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
        <article class="glass-card">
            <div class="card-img-wrapper">
                <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">
                    <img class="card-img-top"
                         src="{{ url_for('static', filename='podcast' + podcast.podcast_id|string + podcast.Estensione) }}"
                         alt="{{ podcast.Titolo }}">
                </a>
            </div>
            <div class="card-body">
                <span class="badge-category mb-2">{{ podcast.Categoria }}</span>
                <h5 class="card-title">
                    <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">{{ podcast.Titolo }}</a>
                </h5>
                <p class="card-author"><i class="bi bi-person"></i> {{ podcast.Username }}</p>
                <div class="star-rating-mini mt-1">
                    {% for i in range(1, 6) %}
                    <i class="bi bi-star{% if i <= podcast.media_voto|round|int %}-fill{% elif i - 0.5 <= podcast.media_voto %}-half{% endif %} star-gold"></i>
                    {% endfor %}
                    <small style="color: var(--text-muted);">{{ podcast.media_voto|round(1) }} ({{ podcast.num_voti }})</small>
                </div>
            </div>
        </article>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Pill Filters -->
<div class="pill-filter-container" data-aos="fade-up">
    <a href="#" class="pill-filter cat-pill active" data-cat="tutte">
        <i class="bi bi-grid-3x3-gap"></i> Tutte
    </a>
    {% for categoria in categorie %}
    <a href="{{ url_for('categoria', nome_categoria=categoria.lower()) }}"
       class="pill-filter cat-pill cat-pill-{{ categoria.lower() }}"
       data-cat="{{ categoria.lower() }}">
        {% if categoria.lower() == 'cucina' %}<i class="bi bi-fire"></i>
        {% elif categoria.lower() == 'scienza' %}<i class="bi bi-rocket-takeoff-fill"></i>
        {% elif categoria.lower() == 'sport' %}<i class="bi bi-trophy-fill"></i>
        {% elif categoria.lower() == 'tecnologia' %}<i class="bi bi-motherboard-fill"></i>
        {% elif categoria.lower() == 'altro' %}<i class="bi bi-stars"></i>
        {% endif %} {{ categoria }}
    </a>
    {% endfor %}
</div>

<!-- Podcast Grid -->
{% if podcasts %}
<div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 card-grid pb-4">
    {% for podcast in podcasts %}
    <div class="col" data-aos="fade-up" data-aos-delay="{{ loop.index0 * 100 }}">
        <article class="glass-card" data-categoria="{{ podcast.Categoria }}">
            <div class="card-img-wrapper">
                <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">
                    <img class="card-img-top"
                         src="{{ url_for('static', filename='podcast' + podcast.podcast_id|string + podcast.Estensione) }}"
                         alt="Immagine del podcast {{ podcast.Titolo }}">
                </a>
            </div>
            <div class="card-body">
                <span class="badge-category mb-2">{{ podcast.Categoria }}</span>
                <h5 class="card-title">
                    <a href="{{ url_for('podcast', podcast_id=podcast.podcast_id) }}">{{ podcast.Titolo }}</a>
                </h5>
                <p class="card-author"><i class="bi bi-person"></i> {{ podcast.Username }}</p>
                {% if ratings.get(podcast.podcast_id) and ratings[podcast.podcast_id].media > 0 %}
                <div class="star-rating-mini mt-1">
                    {% for i in range(1, 6) %}
                    <i class="bi bi-star{% if i <= ratings[podcast.podcast_id].media|round|int %}-fill{% elif i - 0.5 <= ratings[podcast.podcast_id].media %}-half{% endif %} star-gold"></i>
                    {% endfor %}
                    <small style="color: var(--text-muted);">{{ ratings[podcast.podcast_id].media }}</small>
                </div>
                {% endif %}
                <p class="card-text">{{ podcast.Descrizione[:100] }}{% if podcast.Descrizione|length > 100 %}...{% endif %}</p>
            </div>
        </article>
    </div>
    {% endfor %}
</div>

<!-- Pagination -->
{% if total_pages > 1 %}
<nav class="d-flex justify-content-center pb-5">
    <ul class="pagination pagination-dark">
        {% if page > 1 %}
        <li class="page-item"><a class="page-link" href="{{ url_for('home', page=page-1) }}">&laquo;</a></li>
        {% endif %}
        {% for p in range(1, total_pages + 1) %}
        <li class="page-item{% if p == page %} active{% endif %}">
            <a class="page-link" href="{{ url_for('home', page=p) }}">{{ p }}</a>
        </li>
        {% endfor %}
        {% if page < total_pages %}
        <li class="page-item"><a class="page-link" href="{{ url_for('home', page=page+1) }}">&raquo;</a></li>
        {% endif %}
    </ul>
</nav>
{% endif %}

{% else %}
<div class="text-center py-5" data-aos="fade-up">
    <i class="bi bi-broadcast" style="font-size: 3rem; color: var(--text-muted);"></i>
    <h4 class="mt-3" style="color: var(--text-secondary);">Non sono presenti podcast.</h4>
</div>
{% endif %}
{% endblock %}
